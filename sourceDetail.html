<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>素材源详情</title>
  <link href="./libs/element-ui/2.15.3/theme-chalk/index.css" rel="stylesheet" />
  <style>
    .wrap {
      width: 100%;
      height: 100%;
    }

    .title {
      margin-bottom: 20px;
      font-weight: 500;
      font-size: 14px;
      background: #e5e9f2;
      border-radius: 4px;
      line-height: 30px;
      padding-left: 20px;
    }

    /* switch */
    .el-switch {
      position: relative;
      height: 24px;
      line-height: 24px;
    }

    .el-switch.is-checked .el-switch__core {
      background: #179bff;
    }

    .el-switch.is-checked .el-switch__core:after {
      margin-left: -23px;
    }

    .el-switch .el-switch__label,
    .el-switch .el-switch__core {
      height: 24px;
    }

    .el-switch .el-switch__core {
      border-radius: 12px;
      border: none;
      background: #f1f1f1;
    }

    .el-switch .el-switch__core:after {
      box-shadow: 0px 0px 4px 0px rgba(0, 0, 0, 0.3);
      width: 22px;
      height: 22px;
    }

    .el-switch .el-switch__label.is-active {
      color: #333;
    }

    .el-switch .el-switch__label--right {
      margin-left: -28px;
      position: absolute;
      right: 5px;
      top: -1px;
      color: #999;
    }

    .el-switch .el-switch__label--right.is-active {
      color: #fff;
      left: 10px;
    }

    .el-switch .el-switch__label--right>span {
      font-size: 12px;
    }

    /* table */
    .el-table {
      margin-bottom: 20px;
    }

    /* dialog */
    /* .el-dialog__body {
      padding-bottom: 0 !important;
    } */

    /* 返回按钮 */
    .btns {
      text-align: center;
    }

    .back {
      margin-right: 40px;
    }

    /* 设置dialog的宽度 */
    .dialogWidth>.el-dialog {
      width: 1000px !important;
    }
  </style>
</head>

<body>
  <script src="./mockdata.js"></script>
  <div id="app">
    <template>
      <div class="out-dialog">
        <div style="font-size: 16px;text-align: center;line-height: 60px;">素材源详情</div>
        <!-- 表单 -->
        <el-form label-position="right" label-width="100px" :rules="formRules" ref="formData" :model="formData"
          size="mini">
          <div class="title">基本信息</div>
          <!-- 主要信息-展示用 -->
          <el-row>
            <el-col :span="12">
              <el-form-item style="margin-right:0" label="素材源名称:" prop="name">
                <el-input disabled class="inputWidth" v-model="formData.name" placeholder="请输入内容"></el-input>
              </el-form-item>
            </el-col>
          </el-row>

          <div class="title">详细信息</div>

          <el-button v-if="islook!=1" @click="addOrientationDetail" style="margin-bottom:10px" type="primary" plain
            size="small">
            添加素材源定向</el-button>

          <!-- 执行方案列表表格 -->
          <el-table max-height="350px" :data="planListData" height="250" border style="width: 100%" size="mini"
            :header-cell-style="{background:'#e5e9f2'}">
            <el-table-column label="序号" type="index"></el-table-column>
            <el-table-column label="定向名称" prop="name"></el-table-column>
            </el-table-column>
            <el-table-column label="应用状态">
              <template slot-scope="scope">
                {{scope.row.status==0? "未应用":""}}
                {{scope.row.status==1? "已应用":""}}
              </template>
            </el-table-column>

            <el-table-column label="操作" width="170">
              <template slot-scope="scope">
                <el-button type="text" size="small" @click="lookFn(scope.row)">查看</el-button>
                <el-button type="text" v-if="islook!=1" size="small" @click="onEdit(scope.row)">编辑</el-button>
                <el-button type="text" v-if="islook!=1" size="small" @click="onDel(scope.row)"
                  v-if="scope.row.status==0">删除</el-button>
              </template>
            </el-table-column>
          </el-table>
          <!-- 定向详情弹框 -->
          <el-dialog title="定向详情" class="dialogWidth" :visible.sync="orientationDetailVisible" center>
            <template v-if="orientationDetailVisible">
              <orientation-details :type="orientationDetailProps.type" :islook="orientationDetailProps.islook"
                :id="rows.id" :isshowtoptitle="orientationDetailProps.isshowtoptitle" :sourceid="formData.id">
              </orientation-details>
            </template>
          </el-dialog>

          <!-- 奖品列表-->
          <el-table max-height="350px" :data="prizeList" border style="width: 100%" size="mini"
            :header-cell-style="{background:'#e5e9f2'}" style="margin-bottom:20px">
            <el-table-column align="center" label="开关" width="100">
              <template slot-scope="scope">
                <el-switch :disabled="type=='dialog'" inactive-color="#cccccc"
                  @change="conditionChangeSwitch(scope.row)" v-model="scope.row.status==1"
                  :active-text="scope.row.status == 1 ? '开' : '关'" :width="50">
                </el-switch>
              </template>
            </el-table-column>
            <el-table-column align="center" prop="date" label="商务投放限制条件" width="180">
            </el-table-column>
            <el-table-column align="center" prop="date" label="状态">
            </el-table-column>
            <el-table-column align="center" prop="name" label="最近一次操作人">
            </el-table-column>
            <el-table-column v-if="type=='page'" align="center" label="操作" width="150">
              <template slot-scope="scope">
                <el-button type="text" size="small" @click="conditionlook(scope.row)">查看</el-button>
                <el-button type="text" v-if="islook!=1" size="small" @click="conditionEdit(scope.row)">编辑</el-button>
                <el-button type="text" v-if="islook!=1" size="small" @click="conditionDel(scope.row)">删除</el-button>
              </template>
            </el-table-column>
          </el-table>
        </el-form>

      </div>

    </template>
  </div>
  <script src="https://unpkg.com/vue"></script>
  <script src="https://unpkg.com/http-vue-loader"></script>
  <script src="https://unpkg.com/dayjs@1.8.21/dayjs.min.js"></script>
  <script src="./libs/vue/2.6.12/vue.min.js"></script>
  <script src="./libs/element-ui/2.15.3/index.min.js"></script>
  <script src="./libs/axios/0.21.1/axios.min.js"></script>
  <script src="./js/request.js"></script>
  <script src="https://cdn.bootcss.com/lodash.js/4.17.12-pre/lodash.min.js"></script>
  <script>

    function getUrlQuery() {
      let search = location.search
      let obj = {}
      if (search) {
        let query = search.substring(1).split('&')
        query.forEach((queryItem) => {
          let keyValue = queryItem.split('=')
          let [key, value] = keyValue
          if (key) {
            obj[key] = value
          }
        })
      }
      return obj
    }
    var el = new Vue({
      el: '#app',
      props: {
        // type用来标记当前组件是当做dialog使用还是page使用
        type: {
          type: String,
          default: 'page'
        },
      },
      components: {
        'orientation-details': httpVueLoader('./components/orientationDetails.vue')
      },
      data() {
        return {
          formData: {
            name: '',
          },
          islook: "", //标记是否查看1查看，0编辑

          orientationDetailVisible: false, // 定向详情弹框的显示与隐藏
          // 定向详情传参
          orientationDetailProps: {
            type: "dialog",
            islook: 1, //是否查看
            isshowtoptitle: 0 //是否展示title
          },

          row: {}, //查看的那条定向详情数据





          orientationDetailsType: "", //奖品定向详情的展示类型page||dialog
          orientationDetailsVisible: false, // 奖品定向详情弹框的显示与隐藏


          implementationSchemeVisible: false, // 执行方案弹框的显示与隐藏

          implementationSchemeListData: [{
            id: 1,
            status: 1,
            date: '执行方案A001',
            name: '王小虎',
            address: '上海市普陀区金沙江路 1518 弄'
          }, {
            id: 2,
            status: 0,
            date: '执行方案A0011',
            name: '王小虎',
            address: '上海市普陀区金沙江路 1518 弄'
          }, {
            id: 3,
            status: 0,
            date: '执行方案A001111',
            name: '王小虎',
            address: '上海市普陀区金沙江路 1518 弄'
          }, {
            id: 4,
            status: 1,
            date: '执行方案A00101',
            name: '王小虎',
            address: '上海市普陀区金沙江路 1518 弄'
          }, {
            id: 5,
            status: 1,
            date: '执行方案A00108',
            name: '王小虎',
            address: '上海市普陀区金沙江路 1518 弄'
          }, {
            id: 6,
            status: 1,
            date: '执行方案A00106',
            name: '王小虎',
            address: '上海市普陀区金沙江路 1518 弄'
          }, {
            id: 7,
            status: 1,
            date: '执行方案A00107',
            name: '王小虎',
            address: '上海市普陀区金沙江路 1518 弄'
          }], //执行方案列表数据
          multipleSelection: [], //多选执行方案弹框数据
          // filter: {
          //   planName: '',
          //   startTime: '',
          //   endTime: '',
          //   pageNum: 1,
          //   pageSize: 10,
          // },
          // page: {
          //   total: 0,
          // },


          // 执行方案列表弹框搜索表单
          formInline: {
            name: '123',
            region: 'shanghai'
          },

          formRules: {
            name: [
              { required: false, message: '请输入定向名称', trigger: 'change' },
            ]
          },
          // 方案列表
          planListData: [],

          // 条件列表
          prizeList: [{
            id: 1,
            status: 1,
            date: '条件A',
            name: '王小虎',
            address: '上海市普陀区金沙江路 1518 弄'
          }, {
            id: 2,
            status: 0,
            date: '条件A1',
            name: '王小虎',
            address: '上海市普陀区金沙江路 1518 弄'
          }, {
            id: 3,
            status: 0,
            date: '条件A111',
            name: '王小虎',
            address: '上海市普陀区金沙江路 1518 弄'
          }],

          // 方案列表||条件列表当前激活的数据
          rowData: {} //；列表当前行数据

        }
      },
      watch: {

      },
      mounted() {
        window.vue = this;
      },
      methods: {
        // 编辑获取表单详情
        getDetails() {
          this.formData = JSON.parse(sessionStorage.getItem("sourceRow"))

          this.$nextTick(() => {
            this.getSourceOrientationList() //素材源定向列表
            this.getSourcePrizeList() //素材源奖品列表
          })
        },

        // 获取素材源定向列表
        getSourceOrientationList() {
          let params = {
            sourceId: this.formData.id,
            pageNum: "",
            pageSize: "",
            sourceName: ""
          }
          console.log(params)
          // service({
          //   url: '/prize/orientation/mList',
          //   method: 'post',
          //   data: params,
          // }).then(({ data }) => {
          let data = sourceDetailMlist.data
          this.planListData = data.list || [];
          // })
        },

        // 获取素材源奖品列表
        getSourcePrizeList() {
          let params = {
            orientationId: "",
            sourceId: this.formData.id,
            prizeName: ""
          }

          console.log(params)
          // service({
          //   url: '/prize/orientation/pList',
          //   method: 'post',
          //   data: params,
          // }).then(({ data }) => {
          let data = sourceDetailPrizePlist.data;
          this.prizeList = data.list
          // })
        },

        // 添加素材源定向，跳转到定向详情，要携带资源id
        addOrientationDetail(rows) {
          location.href = `./prizeOrientationDetails.html?islook=0&isshowtoptitle=1&type=page&sourceId=${this.formData.id}`
        },

        // 查看定向
        lookFn(rows) {
          this.rows = rows;
          console.log(rows)
          sessionStorage.setItem("rows", JSON.stringify(rows));
          this.orientationDetailVisible = true;
        },
        // 编辑定向
        onEdit(rows) {
          this.rows = rows;
          console.log(rows)
          sessionStorage.setItem("rows", JSON.stringify(rows));
          location.href = `./prizeOrientationDetails.html?id=${rows.id}&islook=0&isshowtoptitle=1&type=page&sourceId=${this.formData.id}`
        },
        // 删除执行方案
        onDel(rows) {
          this.rows = rows
          this.$confirm('确认删除吗?', '提示', {
            confirmButtonText: '确定',
            cancelButtonText: '取消',
            type: 'warning',
          })
            .then(() => {
              this.getDel()
            })
            .catch(() => { })
        },

        // 删除
        getDel() {
          let params = {
            orientationId: this.rows.id,
          }
          service({
            url: 'prize/orientation/delOrientationMP',
            method: 'post',
            data: params
          }).then(() => {
            this.fetchList()
          }).catch((err) => {
            this.$message.error(err.msg);
          })
        },





        // // 执行方案-切换switch
        // planChangeSwitch(row) {
        //   this.planListData.filter((item) => {
        //     if (item.id == row.id) {
        //       item.status = item.status == 1 ? 2 : 1
        //     }
        //   })
        // },
        // // 执行方案-查看,展示奖品定向详情弹框
        // planlook(row) {
        //   console.log("planlook")
        //   this.orientationDetailsVisible = true;
        //   this.orientationDetailsType = "dialog"
        // },
        // // 执行方案-编辑
        // planEdit(row) {
        //   console.log("执行方案-编辑")
        //   this.orientationDetailsType = "page"
        //   location.href = `./prizeOrientationDetails.html?id=${row.id}`
        // },
        // // 执行方案列表-删除按钮
        // planDel(row) {
        //   this.rowData = row
        //   this.$confirm('确认删除吗?', '提示', {
        //     confirmButtonText: '确定',
        //     cancelButtonText: '取消',
        //     type: 'warning',
        //   })
        //     .then(() => {
        //       this.planGetDel()
        //     })
        //     .catch(() => { })
        // },
        // // 执行方案-执行删除请求
        // planGetDel() {
        //   console.log("发送删除请求")
        // },


        // // 执行方案-切换switch
        // conditionChangeSwitch(row) {
        //   this.prizeList.filter((item) => {
        //     if (item.id == row.id) {
        //       item.status = item.status == 1 ? 2 : 1
        //     }
        //   })
        // },
        // // 条件列表-查看
        // conditionlook(row) {
        //   console.log("planlook")
        // },
        // // 条件列表-编辑
        // conditionEdit(row) {
        //   console.log("条件列表-编辑")
        // },
        // // 条件列表列表-删除按钮
        // conditionDel(row) {
        //   this.rowData = row
        //   this.$confirm('确认删除吗?', '提示', {
        //     confirmButtonText: '确定',
        //     cancelButtonText: '取消',
        //     type: 'warning',
        //   })
        //     .then(() => {
        //       this.conditionGetDel()
        //     })
        //     .catch(() => { })
        // },
        // // 条件列表-执行删除请求
        // conditionGetDel() {
        //   console.log("发送删除请求")
        // },


      },
      created() {
        let query = getUrlQuery()
        if (query.id) {
          this.getDetails();

          this.islook = query.islook;
        }
        // 获取项目列表
        // this.getProjectList()
      },
    })
  </script>
</body>

</html>